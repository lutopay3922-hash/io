<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëŒ€ì‹œë³´ë“œ</title>
</head>
<body>

<h1>ëŒ€ì‹œë³´ë“œ</h1>

<h3>ë©”ì¸ ë¬¸êµ¬ ìˆ˜ì •</h3>
<input id="titleInput" placeholder="ë©”ì¸ ì œëª©">
<input id="descInput" placeholder="ì„¤ëª…">
<br><br>
<button onclick="saveData()">ë³€ê²½ì‚¬í•­ ì¦‰ì‹œ ì ìš©</button>

<hr>

<h3>ì£¼ë¬¸ ëª©ë¡</h3>
<table border="1">
  <thead>
    <tr>
      <th>ì£¼ë¬¸ë²ˆí˜¸</th>
      <th>ì´ë¦„</th>
      <th>íœ´ëŒ€í°</th>
      <th>ìƒíƒœ</th>
      <th>ê´€ë¦¬</th>
    </tr>
  </thead>
  <tbody id="orderTable"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, collection, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "ì—¬ê¸°ì—_API_KEY",
  authDomain: "zcash-web.firebaseapp.com",
  projectId: "zcash-web",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ğŸ”´ ë©”ì¸ ë°ì´í„° ì €ì¥ */
window.saveData = async function () {
  await setDoc(doc(db, "siteData", "main"), {
    title: document.getElementById("titleInput").value,
    desc: document.getElementById("descInput").value,
    updatedAt: Date.now()
  });
  alert("ì‹¤ì‹œê°„ ë°˜ì˜ ì™„ë£Œ");
};

/* ğŸ”´ ì£¼ë¬¸ ì‹¤ì‹œê°„ í‘œì‹œ */
onSnapshot(collection(db, "orders"), (snapshot) => {
  const table = document.getElementById("orderTable");
  table.innerHTML = "";

  snapshot.forEach(docSnap => {
    const o = docSnap.data();
    table.innerHTML += `
      <tr>
        <td>${o.orderNo}</td>
        <td>${o.buyer}</td>
        <td>${o.phone}</td>
        <td>${o.status}</td>
        <td>
          ${o.status === "ì…ê¸ˆëŒ€ê¸°"
            ? `<button onclick="markPaid('${docSnap.id}')">ì…ê¸ˆì™„ë£Œ</button>`
            : "-"}
        </td>
      </tr>
    `;
  });
});

/* ğŸ”´ ì…ê¸ˆì™„ë£Œ ì²˜ë¦¬ */
window.markPaid = async function (id) {
  await updateDoc(doc(db, "orders", id), {
    status: "ì…ê¸ˆì™„ë£Œ"
  });
  alert("ì…ê¸ˆì™„ë£Œ ì²˜ë¦¬ë¨");
};
</script>

</body>
</html>
