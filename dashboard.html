
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>루투페이 관리자 센터</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains_Mono:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background: #0a0514; color: #eee; }
        .glass { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(10px); }
        .stat-card { border-left: 4px solid #a855f7; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .input-dark { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px; font-size: 14px; width: 100%; outline: none; transition: border-color 0.3s; }
        .input-dark:focus { border-color: #a855f7; }
    </style>
</head>
<body class="min-h-screen pb-20">
    <!-- Navigation -->
    <nav class="glass sticky top-0 z-50 px-6 py-4 flex justify-between items-center mb-10">
        <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-user-shield text-white text-xs"></i>
            </div>
            <span class="font-bold tracking-tighter text-xl">ROOTOO <span class="text-purple-500">ADMIN</span></span>
        </div>
        <div id="auth-status" class="text-xs font-bold text-white/40 flex items-center">
            <span class="w-2 h-2 bg-yellow-500 rounded-full mr-2 animate-pulse"></span>
            CONNECTING...
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6">
        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="glass p-6 rounded-3xl stat-card">
                <p class="text-white/40 text-xs font-bold uppercase mb-2">오늘의 주문</p>
                <h2 id="stat-today-orders" class="text-3xl font-black">0</h2>
            </div>
            <div class="glass p-6 rounded-3xl stat-card" style="border-left-color: #00f0ff;">
                <p class="text-white/40 text-xs font-bold uppercase mb-2">총 판매량</p>
                <h2 id="stat-total-sales" class="text-3xl font-black">0</h2>
            </div>
            <div class="glass p-6 rounded-3xl stat-card" style="border-left-color: #facc15;">
                <p class="text-white/40 text-xs font-bold uppercase mb-2">시스템 상태</p>
                <h2 class="text-3xl font-black text-green-400">ONLINE</h2>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
            <!-- Left Column: Orders & Products List -->
            <div class="lg:col-span-2 space-y-12">
                <!-- Order Management -->
                <section class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold"><i class="fas fa-shopping-cart mr-3 text-purple-500"></i>실시간 주문 내역</h3>
                    </div>
                    <div id="order-list" class="space-y-4">
                        <div class="glass p-10 rounded-3xl text-center text-white/20 italic">주문을 불러오고 있습니다...</div>
                    </div>
                </section>

                <!-- Product Management (Deletion Feature Added) -->
                <section class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold"><i class="fas fa-boxes mr-3 text-cyan-400"></i>등록된 상품 관리</h3>
                    </div>
                    <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="glass p-10 rounded-3xl text-center text-white/20 italic col-span-full">상품 목록을 불러오고 있습니다...</div>
                    </div>
                </section>
            </div>

            <!-- Right Column: Settings & Controls -->
            <div class="space-y-10">
                <!-- Banner Control (New!) -->
                <section class="glass p-8 rounded-[32px] space-y-6">
                    <h3 class="text-lg font-bold border-b border-white/5 pb-4"><i class="fas fa-ad mr-2 text-cyan-400"></i>메인 배너 설정</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] text-white/40 font-bold uppercase">배너 제목</label>
                            <input type="text" id="banner-title" placeholder="예: 배달의민족" class="input-dark mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] text-white/40 font-bold uppercase">할인율 (%)</label>
                            <input type="text" id="banner-rate" placeholder="예: 12%" class="input-dark mt-1">
                        </div>
                        <div>
                            <label class="text-[10px] text-white/40 font-bold uppercase">상세 설명</label>
                            <input type="text" id="banner-desc" placeholder="배너 하단 설명 문구" class="input-dark mt-1">
                        </div>
                        <button onclick="updateBannerSettings()" class="w-full py-4 bg-cyan-600 rounded-2xl font-bold text-sm hover:bg-cyan-500 transition-all">배너 즉시 업데이트</button>
                    </div>
                </section>

                <!-- Top Notice Control -->
                <section class="glass p-8 rounded-[32px] space-y-6">
                    <h3 class="text-lg font-bold border-b border-white/5 pb-4"><i class="fas fa-bullhorn mr-2 text-purple-500"></i>상단 공지 설정</h3>
                    <div class="space-y-4">
                        <input type="text" id="input-top-notice" placeholder="상단 공지 텍스트" class="input-dark">
                        <button onclick="updateSettings()" class="w-full py-4 bg-purple-600 rounded-2xl font-bold text-sm hover:bg-purple-500 transition-all">공지사항 즉시 적용</button>
                    </div>
                </section>

                <!-- Product Add -->
                <section class="glass p-8 rounded-[32px] space-y-6">
                    <h3 class="text-lg font-bold border-b border-white/5 pb-4"><i class="fas fa-plus mr-2 text-emerald-500"></i>상품 신규 등록</h3>
                    <div class="space-y-4">
                        <input type="text" id="p-name" placeholder="상품명 (예: 신세계 상품권)" class="input-dark">
                        <input type="number" id="p-price" placeholder="판매가 (숫자만)" class="input-dark">
                        <input type="number" id="p-rate" placeholder="할인율 (예: 5)" class="input-dark">
                        <select id="p-icon" class="input-dark">
                            <option value="fas fa-utensils">식음료 (배민/쿠팡)</option>
                            <option value="fas fa-shopping-bag">쇼핑 (신세계/컬리)</option>
                            <option value="fas fa-gamepad">게임 (구글/넥슨)</option>
                            <option value="fas fa-coffee">카페 (스타벅스)</option>
                            <option value="fas fa-credit-card">기타 카드</option>
                        </select>
                        <button onclick="addProduct()" class="w-full py-4 bg-emerald-600 rounded-2xl font-bold text-sm hover:bg-emerald-500 transition-all">상품 등록하기</button>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, collection, addDoc, onSnapshot, doc, 
            setDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAiygY_0VqxYpwb6agBJzpq6pqDFzNk-eE",
            authDomain: "zcash-web-46657.firebaseapp.com",
            projectId: "zcash-web-46657",
            storageBucket: "zcash-web-46657.firebasestorage.app",
            messagingSenderId: "548237401338",
            appId: "1:548237401338:web:c060c31ec71a8dfa03bd43",
            measurementId: "G-95X3XEVX2M"
        };
        
        const appId = 'zcash-web-46657';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (u) => {
            if (u) {
                document.getElementById('auth-status').innerHTML = `<span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>DB CONNECTED`;
                initDashboard();
            } else {
                signInAnonymously(auth);
            }
        });

        function initDashboard() {
            // 1. 주문 목록
            const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
            onSnapshot(ordersRef, (snapshot) => {
                const list = document.getElementById('order-list');
                list.innerHTML = '';
                document.getElementById('stat-today-orders').innerText = snapshot.size;
                if (snapshot.empty) {
                    list.innerHTML = '<div class="glass p-10 rounded-3xl text-center text-white/20 italic">신규 주문이 없습니다.</div>';
                    return;
                }
                const orders = [];
                snapshot.forEach(doc => orders.push({id: doc.id, ...doc.data()}));
                orders.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                orders.forEach(order => {
                    const div = document.createElement('div');
                    div.className = "glass p-6 rounded-2xl flex flex-col md:flex-row justify-between items-start md:items-center";
                    div.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400"><i class="fas fa-wallet"></i></div>
                            <div>
                                <p class="text-[10px] text-white/40">${order.createdAt ? new Date(order.createdAt.seconds * 1000).toLocaleString() : 'Just now'}</p>
                                <p class="font-bold text-white">${order.customerName} <span class="text-purple-400">/ ${order.productName}</span></p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="font-black text-sm">${Number(order.price).toLocaleString()}원</span>
                            <button onclick="deleteOrder('${order.id}')" class="p-2 text-white/20 hover:text-red-500 transition-colors"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    list.appendChild(div);
                });
            });

            // 2. 상품 목록 관리
            const productsRef = collection(db, 'artifacts', appId, 'public', 'data', 'products');
            onSnapshot(productsRef, (snapshot) => {
                const list = document.getElementById('product-list');
                list.innerHTML = '';
                snapshot.forEach(docSnap => {
                    const p = docSnap.data();
                    const div = document.createElement('div');
                    div.className = "glass p-5 rounded-2xl flex items-center justify-between";
                    div.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center"><i class="${p.icon} text-white/50 text-xs"></i></div>
                            <div>
                                <p class="text-sm font-bold text-white">${p.name}</p>
                                <p class="text-[10px] text-purple-400">${p.rate}% 할인</p>
                            </div>
                        </div>
                        <button onclick="deleteProduct('${docSnap.id}')" class="text-[10px] font-bold text-red-500/50 hover:text-red-500">삭제</button>
                    `;
                    list.appendChild(div);
                });
            });

            // 3. 설정 (판매량 & 배너 & 공지)
            const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'main');
            onSnapshot(settingsRef, (snap) => {
                if(snap.exists()) {
                    const d = snap.data();
                    document.getElementById('stat-total-sales').innerText = d.totalSales || 0;
                    document.getElementById('input-top-notice').value = d.topNotice || "";
                    document.getElementById('banner-title').value = d.bannerTitle || "배달의민족";
                    document.getElementById('banner-rate').value = d.bannerRate || "12%";
                    document.getElementById('banner-desc').value = d.bannerDesc || "";
                }
            });
        }

            // --- 액션 함수들 ---
        window.updateSettings = async () => {
            const val = document.getElementById('input-top-notice').value;
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'main'), { topNotice: val }, { merge: true });
            alert('공지가 업데이트되었습니다.');
        };

        window.updateBannerSettings = async () => {
            const title = document.getElementById('banner-title').value;
            const rate = document.getElementById('banner-rate').value;
            const desc = document.getElementById('banner-desc').value;
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'main'), {
                bannerTitle: title,
                bannerRate: rate,
                bannerDesc: desc
            }, { merge: true });
            alert('배너 설정이 저장되었습니다.');
        };

        window.addProduct = async () => {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const rate = document.getElementById('p-rate').value;
            const icon = document.getElementById('p-icon').value;
            if(!name || !price) return alert('상품 정보를 입력하세요.');
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), {
                name, price, rate, icon, createdAt: serverTimestamp()
            });
            alert('상품 등록 완료!');
            document.getElementById('p-name').value = '';
            document.getElementById('p-price').value = '';
        };

        window.deleteProduct = async (id) => {
            if(confirm('이 상품을 삭제하시겠습니까? 사용자 페이지에서도 즉시 사라집니다.')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id));
            }
        };

        window.deleteOrder = async (id) => {
            if(confirm('주문 내역을 삭제하시겠습니까?')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', id));
            }
        };

    </script>
</body>
</html>
